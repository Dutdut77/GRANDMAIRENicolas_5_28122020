class Article{description;imageUrl;lenses;name;price;_id;constructor(e){for(const[a,t]of Object.entries(e))this[a]=t}afficheResume(){return`\n        <div class="card">\n            <div class="card__list-image" style="background-image: url('${this.imageUrl}');"></div>\n            <div class="card__list-content">\n                <div class="card__content-titre">\n                    <h3>${this.name}</h3>\n                </div>\n                <div class="card__content-desc">\n                ${this.description}  \n                </div>\n            </div>\n            <div class="card__list_bouton">\n                <div class="card__btn btn-grad-color" onclick="orinoco.components.composant_${this._id}.changePage()">Détail</div>\n            </div>\n        </div>\n             `}afficheDetails(){return`\n        <div class="produit">\n\n            <div class="produit-image" style="background-image: url('${this.imageUrl}');"></div>\n            \n            <div class="produit-content">\n                <div class="produit-titre">\n                    <h3>${this.name}</h3>\n                </div>\n                <div class="produit-prix">\n                     ${this.price/100} € \n                </div>  \n            </div>\n \n            <div class="produit-desc">\n                <article>\n                ${this.description}\n                </article>             \n            </div>     \n            \n            <select name="lenses" class="lenses">\n                <option value="">Choisissez une option :</option>\n                ${this.showVariants(this.lenses)}      \n            </select>\n            \n            <div class="produit-bouton">\n                <div class="produit-btn" onclick="orinoco.cart.add('${this._id}')">Ajouter au Panier</div>\n            </div>\n\n        </div>\n             `}showPanier(){return` <div class="show_panier">                \n      <div class="card_panier_img">\n              <div class="panier_img" style="background-image: url('${this.imageUrl}');"></div>\n      </div>              \n          \n       <div class="panier_content">\n          <div class="panier_content_titre">\n              <h4>${this.name}</h4>\n          </div>\n          <div class="panier_content_quantite">\n              <div class="quantite_titre">Quantité :</div>\n              <div class="quantite_box"> \n                  <div class="quantite_box_moins" onclick="orinoco.pageManager.page.moins('${this._id}')"></div>\n                  <div class="quantite_box_nombre">${this.qte}</div>\n                   <div class="quantite_box_plus" onclick="orinoco.pageManager.page.plus('${this._id}')"></div>\n              </div>    \n          </div>   \n      </div>\n  \n      <div class="panier_price">\n          <div class="corbeille" onclick="orinoco.pageManager.page.removeProduct('${this._id}')"></div>\n          <h4>${this.price/100*this.qte}€</h4> \n      </div> \n\n  </div>\n`}showVariants(e){let a="";for(let t=0,n=e.length;t<n;t++)a+=`<option value="${this.lenses[t]}"> ${this.lenses[t]}</option>`;return a}changePage(){orinoco.pageManager.changePage("produit_"+this._id,"Orinoco - Caméra "+this.name)}}class Cart{content=orinoco.dataManager.reloadCart();constructor(e){this.DOM=document.createElement("cart"),this.domTarget=e,this.render()}render(){if(this.content.length>0)return this.domTarget.hasChildNodes()||this.domTarget.appendChild(this.DOM),void(this.DOM.innerText=this.content.length);this.domTarget.hasChildNodes()&&this.domTarget.removeChild(this.DOM)}add(e){this.content.push(e),this.render(),orinoco.dataManager.saveCart(this.content)}updateFromPagePanier(e){this.content=e,this.render()}}class Home{constructor(e){this.getData(e)}async getData(e){let a="";const t=await orinoco.dataManager.getAllProducts();for(let e=0,n=t.length;e<n;e++)orinoco.components["composant_"+t[e]._id]=new Article(t[e]),a+=orinoco.components["composant_"+t[e]._id].afficheResume();e.innerHTML=a}}class Panier{fields={};constructor(e){this.getData(e),["nom","prenom","adresse","ville","email"].forEach((e=>this.fields[e]=!1))}async getData(e){const a=orinoco.dataManager.reloadCart();this.products=await this.cartArrayToCartObject(a),this.render(e)}render(e){let a,t="",n=0;for(const e of Object.values(this.products))a=new Article(e),t+=a.showPanier(),n+=e.qte*e.price/100;e.innerHTML=this.templatePanier(t,n)}async cartArrayToCartObject(e){const a={};for(let t=0,n=e.length;t<n;t++)void 0!==a[e[t]]?a[e[t]].qte++:a[e[t]]={...await orinoco.dataManager.getProduct(e[t]),qte:1};return a}templatePanier(e,a){return`\n        <div class="panier">\n\n            <div class="card_panier">\n                <div class="card_panier_titre">\n                    <h1> MON PANIER : </h1>\n                </div>           \n                     ${e}\n                <div class="card_panier_total">\n                    <h2> TOTAL : </h2>\n                    <div class="total_price">\n                        ${a} €\n                    </div>\n                </div>\n            </div>\n\n            \n\n            <div class="contact">\n                    <h2> Vos coordonnées :</h2>               \n                    <div class="form__group">\n                        <label for="nom">Nom : <span class="error_nom" aria-live="polite"></span></label>\n                        <input type="text" name="nom" id="nom" pattern="[A-Z]{2,}" oninput="orinoco.pageManager.page.isValid(this)">\n                    </div>\n                    <div class="form__group">\n                        <label for="prenom">Prénom: <span class="error_prenom" aria-live="polite"></span></label>\n                        <input type="text" name="prenom" id="prenom" pattern="[A-Z][a-z]{1,}" oninput="orinoco.pageManager.page.isValid(this)">\n                    </div>\n                    <div class="form__group">\n                        <label for="adresse">Adresse : <span class="error_adresse" aria-live="polite"></span></label>\n                        <input type="text" name="adresse" id="adresse" oninput="orinoco.pageManager.page.isValid(this)">\n                    </div>\n                    <div class="form__group">\n                        <label for="ville">Ville :<span class="error_ville" aria-live="polite"></span></label>\n                        <input type="text" name="ville" id="ville" oninput="orinoco.pageManager.page.isValid(this)">\n                    </div>\n                    <div class="form__group">\n                        <label for="email">Email :<span class="error_email" aria-live="polite"></span></label>\n                        <input type="email" name="email" id="email" pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9._-]+.[a-zA-Z]{2,4}$" oninput="orinoco.pageManager.page.isValid(this)">\n                    </div>\n\n                    <div class="form-btn">\n                        <button class="valid-btn" type="button" id="valid-btn" onclick="orinoco.pageManager.page.sendForm(event)" disabled value="Valider votre commande">Valider votre commande</button>\n                    </div>         \n            </div>\n\n\n\n\n        </div>\n        \n        <div id="myModal" class="modal">\n        </div>\n                    `}plus(e){this.products[e].qte++,this.updateCount()}moins(e){if(0===this.products[e].qte)return this.removeProduct(e);this.products[e].qte--,this.updateCount()}updateCount(){const e=[];for(const[a,t]of Object.entries(this.products))for(let n=t.qte;n>0;n--)e.push(a);orinoco.dataManager.saveCart(e),orinoco.pageManager.showPage("panier"),orinoco.cart.updateFromPagePanier(e)}removeProduct(e){delete this.products[e],this.updateCount()}async sendForm(e){e.stopPropagation(),e.preventDefault();const a=document.getElementById("nom").value,t=document.getElementById("prenom").value,n=document.getElementById("adresse").value,i=document.getElementById("ville").value,r=document.getElementById("email").value,o=[];for(const[e,a]of Object.entries(this.products))for(let e=a.qte;e>0;e--)o.push(a._id);const s={contact:{lastName:a,firstName:t,address:n,city:i,email:r},products:o},c=await orinoco.dataManager.postPanier(s);this.afficheModal(c)}async afficheModal(e){let a="",t=[],n=0;const i=e.products;for(let e=0,a=i.length;e<a;e++)t.push(i[e]._id);const r=await this.cartArrayToCartObject(t);for(const e of Object.values(r))n+=e.price*e.qte/100,a+=`\n            <div class="recap">\n                <div class="recap-titre">${e.name}</div>\n                <div class="recap-qte">Quantité : ${e.qte}</div>\n                <div class="recap-price">${e.price/100*e.qte} €</div>                       \n            </div>\n            `;const o=`\n        <div class="modal-content">\n            \n            <div class="modal-header">\n                <h2>Commande validée.</h2>\n                <p>N° ${e.orderId}</p>        \n            </div>\n\n            <div class="modal-body">\n                <hr>\n                <div class="modal-section">\n                    <div class="modal-section-titre">Récapitulatif :</div>\n                    ${a}\n                    <hr>\n                    <div class="modal-total">            \n                        Montant total : ${n} €\n                    </div>\n                </div>\n                <hr>\n                <div class="modal-section">\n                    <div class="modal-section-titre">Adresse de Livraison :</div>            \n                    <p>${e.contact.lastName} ${e.contact.firstName}</p>  \n                    <p>${e.contact.address} </p>\n                    <p>${e.contact.city} </p>\n                </div>                \n                <hr>\n                <div class="modal-facture">\n                    <p><h3>Orinoco</h3> vous remercie pour votre commande. Une facture vous sera envoyée sur votre addresse mail : <p class="mail">${e.contact.email}</p></p>           \n                </div>\n            </div>\n\n            <div class="modal-footer">  \n                <div class="modal-btn" type="button" onclick="orinoco.dataManager.deletePanier()">Retour à l'accueil</div>\n            </div>\n        </div>\n        `;document.querySelector(".modal").innerHTML=o,this.optionModal()}optionModal(){document.getElementById("myModal").style.display="block"}isValid(e){if("nom"==e.name){let a=document.querySelector(".error_nom");if(""===e.value)return e.className="",a.className="error_nom empty";if(!e.validity.valid)return e.className="",a.className="error_nom badFormatNom";a.className="error_nom"}if("prenom"==e.name){let a=document.querySelector(".error_prenom");if(""===e.value)return e.className="",a.className="error_prenom empty";if(!e.validity.valid)return e.className="",a.className="error_prenom badFormatPrenom";a.className="error_prenom"}if("adresse"==e.name){let a=document.querySelector(".error_adresse");if(""===e.value)return e.className="",a.className="error_adresse empty";if(!e.validity.valid)return e.className="",a.className="error_adresse badFormat";a.className="error_adresse"}if("ville"==e.name){let a=document.querySelector(".error_ville");if(""===e.value)return a.className="error_ville empty";if(!e.validity.valid)return a.className="error_ville badFormat";a.className="error_ville"}if("email"==e.name){let a=document.querySelector(".error_email");if(""===e.value)return a.className="error_email empty";if(!e.validity.valid)return a.className="error_email badFormat";a.className="error_email"}e.className="success",this.fields[e.id]=!0;let a=0;const t=Object.values(this.fields).length;for(const e of Object.values(this.fields))e&&a++;a===t&&(document.getElementById("valid-btn").disabled=!1,console.log(e))}}class Produit{constructor(e,a){this.getData(e,a)}async getData(e,a){const t=await orinoco.dataManager.getProduct(a),n=new Article(t);e.innerHTML=`\n          <select name="camera" class="camera" onchange="orinoco.pageManager.changePage('produit_' + this.value, 'Oricono - Camera '+this.options[this.selectedIndex].text)">        \n              ${await this.selectCamera(n.name)}\n          </select>\n          ${n.afficheDetails()}\n        `}async selectCamera(e){let a="";const t=await orinoco.dataManager.getAllProducts();for(let n=0,i=t.length;n<i;n++)a+=`<option ${e===t[n].name?"selected":""} value="${t[n]._id}">${t[n].name}</option>`;return a}}class DataManager{products=null;src;constructor(e){this.src=e}async getAllProducts(){const e=await fetch(this.src);return this.products=await e.json(),this.products}async getProduct(e){if(null!==this.products)return this.findInProducts(e);const a=await fetch(this.src+"/"+e);return await a.json()}async postPanier(e){const a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)},t=await fetch(this.src+"/order",a);return await t.json()}findInProducts(e){for(let a=0,t=this.products.length;a<t;a++)if(this.products[a]._id===e)return this.products[a];throw"can't find product"}saveCart(e){localStorage.setItem("cart",JSON.stringify(e))}reloadCart(){const e=localStorage.getItem("cart");return null===e?[]:JSON.parse(e)}deletePanier(){localStorage.clear(Cart),orinoco.cart.content=[],orinoco.cart.render(),orinoco.pageManager.changePage("","Orinoco - Vente de caméras en ligne")}}class PageManager{page=null;domTarget=null;constructor(e){this.domTarget=e,this.showPage(window.location.search.slice(1)),window.onpopstate=()=>this.showPage(window.location.search.slice(1))}showPage(e){return""===e?this.page=new Home(this.domTarget):"panier"===e?this.page=new Panier(this.domTarget):"produit"===e.slice(0,7)?this.page=new Produit(this.domTarget,e.slice(8)):void(this.page=new PageError)}changePage(e,a){document.getElementById("menuCheck").checked="none",document.title=a,history.pushState({},a,"?"+e),this.showPage(e)}}const orinoco={dataManager:new DataManager("http://localhost:3000/api/cameras"),components:{}};orinoco.cart=new Cart(document.querySelector(".shopping_cart")),orinoco.pageManager=new PageManager(document.querySelector("main"));