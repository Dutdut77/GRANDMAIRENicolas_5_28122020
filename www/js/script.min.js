class Cart{content=orinoco.dataManager.reloadCart();constructor(e){this.DOM=document.createElement("cart"),this.domTarget=e,this.render()}render(){if(this.content.length>0)return this.domTarget.hasChildNodes()||this.domTarget.appendChild(this.DOM),void(this.DOM.innerText=this.content.length);this.domTarget.hasChildNodes()&&this.domTarget.removeChild(this.DOM)}add(e){this.content.push(e),this.render(),orinoco.dataManager.saveCart(this.content)}updateFromPagePanier(e){this.content=e,this.render()}}class Article{description;imageUrl;lenses;name;price;_id;constructor(e){e.lens;for(const[t,a]of Object.entries(e))this[t]=a}afficheResume(){return`     \n        <div class="card">\n            <div class="card__list-image" style="background-image: url('${this.imageUrl}');"></div>\n            <div class="card__list-content">\n                <div class="card__content-titre">\n                    <h1>${this.name}</h1>\n                </div>\n                <div class="card__content-desc">\n                ${this.description}  \n                </div>\n            </div>\n            <div class="card__list_bouton">\n                <button class="card__btn btn-grad-color" onclick="orinoco.components.composant_${this._id}.changePage()">Détail</button>\n            </div>\n        </div>\n             `}afficheDetails(){return`\n        <div class="produit">\n\n            <div class="produit-image" style="background-image: url('${this.imageUrl}');"></div>\n            \n            <div class="produit-content">\n                <div class="produit-titre">\n                    <h1>${this.name}</h1>\n                </div>\n                <div class="produit-prix">\n                     ${this.price/100} € \n                </div>  \n            </div>\n \n            <div class="produit-desc">\n                <article>\n                ${this.description}\n                </article>             \n            </div>  \n\n            <label for="lenses" class="lenses-label">Choisissez une option :</label>\n            <select name="lenses" id="lenses" class="lenses">\n                ${this.showVariants(this.lenses)}      \n            </select>\n            \n            <div class="produit-bouton">\n                <button class="produit-btn" onclick="orinoco.cart.add('${this._id}')">Ajouter au Panier</button>\n            </div>\n\n        </div>\n             `}showPanier(){return` <div class="show_panier">                \n      <div class="card_panier_img">\n              <div class="panier_img" style="background-image: url('${this.imageUrl}');"></div>\n      </div>              \n          \n       <div class="panier_content">\n          <div class="panier_content_titre">\n              <h2>${this.name}</h2>\n          </div>\n          <div class="panier_content_quantite">\n              <div class="quantite_titre">Quantité :</div>\n              <div class="quantite_box"> \n                  <button class="quantite_box_moins" onclick="orinoco.pageManager.page.moins('${this._id}')">-</button>\n                  <div class="quantite_box_nombre">${this.qte}</div>\n                   <button class="quantite_box_plus" onclick="orinoco.pageManager.page.plus('${this._id}')">+</button>\n              </div>    \n          </div>   \n      </div>\n  \n      <div class="panier_price">\n          <div class="corbeille" onclick="orinoco.pageManager.page.removeProduct('${this._id}')"></div>\n          <h2>${this.price/100*this.qte}€</h2> \n      </div> \n\n  </div>\n`}showVariants(e){let t="";for(let a=0,n=e.length;a<n;a++)t+=`<option value="${this.lenses[a]}"> ${this.lenses[a]}</option>`;return t}changePage(){orinoco.pageManager.changePage("produit_"+this._id,"Orinoco - Caméra "+this.name)}}class Home{constructor(e){this.getData(e)}async getData(e){let t="";const a=await orinoco.dataManager.getAllProducts();for(let e=0,n=a.length;e<n;e++)orinoco.components["composant_"+a[e]._id]=new Article(a[e]),t+=orinoco.components["composant_"+a[e]._id].afficheResume();e.innerHTML=t}}class Panier{fields={};constructor(e){this.getData(e),["nom","prenom","adresse","ville","email"].forEach((e=>this.fields[e]=!1))}async getData(e){const t=orinoco.dataManager.reloadCart();this.products=await this.cartArrayToCartObject(t),this.render(e)}render(e){let t,a="",n=0;for(const e of Object.values(this.products))t=new Article(e),a+=t.showPanier(),n+=e.qte*e.price/100;if(0===n)return e.innerHTML=this.templatePanierVide();e.innerHTML=this.templatePanier(a,n)}async cartArrayToCartObject(e){const t={};for(let a=0,n=e.length;a<n;a++)void 0!==t[e[a]]?t[e[a]].qte++:t[e[a]]={...await orinoco.dataManager.getProduct(e[a]),qte:1};return t}templatePanier(e,t){return`\n        <div class="panier">\n\n            <div class="card_panier">\n                <div class="card_panier_titre">\n                    <h1> VOTRE PANIER : </h1>\n                </div>           \n                     ${e}\n                <div class="card_panier_total">\n                    <h2> TOTAL : </h2>\n                    <div class="total_price">\n                        ${t} €\n                    </div>\n                </div>\n            </div>\n\n            \n\n            <div class="contact">\n                    <h2> Vos coordonnées :</h2>               \n                    <div class="form__group">\n                        <label for="nom">Nom : <span class="error_nom" aria-live="polite"></span></label>\n                        <input type="text" name="nom" id="nom" pattern="[A-Z]{2,}" oninput="orinoco.pageManager.page.isValid(this)">\n                    </div>\n                    <div class="form__group">\n                        <label for="prenom">Prénom: <span class="error_prenom" aria-live="polite"></span></label>\n                        <input type="text" name="prenom" id="prenom" pattern="[A-Z][a-z]{1,}" oninput="orinoco.pageManager.page.isValid(this)">\n                    </div>\n                    <div class="form__group">\n                        <label for="adresse">Adresse : <span class="error_adresse" aria-live="polite"></span></label>\n                        <input type="text" name="adresse" id="adresse" oninput="orinoco.pageManager.page.isValid(this)">\n                    </div>\n                    <div class="form__group">\n                        <label for="ville">Ville :<span class="error_ville" aria-live="polite"></span></label>\n                        <input type="text" name="ville" id="ville" oninput="orinoco.pageManager.page.isValid(this)">\n                    </div>\n                    <div class="form__group">\n                        <label for="email">Email :<span class="error_email" aria-live="polite"></span></label>\n                        <input type="email" name="email" id="email" pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9._-]+.[a-zA-Z]{2,4}$" oninput="orinoco.pageManager.page.isValid(this)">\n                    </div>\n\n                    <div class="form-btn">\n                        <button class="valid-btn" type="button" id="valid-btn" onclick="orinoco.pageManager.page.sendForm(event)" disabled value="Valider votre commande">Valider votre commande</button>\n                    </div>         \n            </div>\n\n\n\n\n        </div>\n        \n        <div id="myModal" class="modal">\n        </div>\n                    `}templatePanierVide(){return'\n        <div class="panier">\n\n            <div class="card_panier">\n                    <span class="card_panier-vide"> Votre panier est vide.</span>\n                    <div class="card_panier-retour" type="button" onclick="orinoco.pageManager.changePage(\'\', \'Orinoco - Vente de caméras en ligne\')">Retour à l\'accueil</div>\n            </div>\n\n            \n\n         </div>\n                        '}plus(e){this.products[e].qte++,this.updateCount()}moins(e){if(0===this.products[e].qte)return this.removeProduct(e);this.products[e].qte--,this.updateCount()}updateCount(){const e=[];for(const[t,a]of Object.entries(this.products))for(let n=a.qte;n>0;n--)e.push(t);orinoco.dataManager.saveCart(e),orinoco.pageManager.showPage("panier"),orinoco.cart.updateFromPagePanier(e)}removeProduct(e){delete this.products[e],this.updateCount()}async sendForm(e){e.stopPropagation(),e.preventDefault();const t=document.getElementById("nom").value,a=document.getElementById("prenom").value,n=document.getElementById("adresse").value,i=document.getElementById("ville").value,s=document.getElementById("email").value,r=[];for(const[e,t]of Object.entries(this.products))for(let e=t.qte;e>0;e--)r.push(t._id);const o={contact:{lastName:t,firstName:a,address:n,city:i,email:s},products:r},c=await orinoco.dataManager.postPanier(o);this.afficheModal(c)}async afficheModal(e){let t="",a=[],n=0;const i=e.products;for(let e=0,t=i.length;e<t;e++)a.push(i[e]._id);const s=await this.cartArrayToCartObject(a);for(const e of Object.values(s))n+=e.price*e.qte/100,t+=`\n            <div class="recap">\n                <div class="recap-titre">${e.name}</div>\n                <div class="recap-qte">Quantité : ${e.qte}</div>\n                <div class="recap-price">${e.price/100*e.qte} €</div>                       \n            </div>\n            `;const r=`\n        <div class="modal-content">\n            \n            <div class="modal-header">\n                <h2>Commande validée.</h2>\n                <p>N° ${e.orderId}</p>        \n            </div>\n\n            <div class="modal-body">\n                <hr>\n                <div class="modal-section">\n                    <div class="modal-section-titre">Récapitulatif :</div>\n                    ${t}\n                    <hr>\n                    <div class="modal-total">            \n                        Montant total : ${n} €\n                    </div>\n                </div>\n                <hr>\n                <div class="modal-section">\n                    <div class="modal-section-titre">Adresse de Livraison :</div>            \n                    <p>${e.contact.lastName} ${e.contact.firstName}</p>  \n                    <p>${e.contact.address} </p>\n                    <p>${e.contact.city} </p>\n                </div>                \n                <hr>\n                <div class="modal-facture">\n                    <p><h3>Orinoco</h3> vous remercie pour votre commande. Une facture vous sera envoyée sur votre addresse mail : <p class="mail">${e.contact.email}</p></p>           \n                </div>\n            </div>\n\n            <div class="modal-footer">  \n                <button class="modal-btn" type="button" onclick="orinoco.dataManager.deletePanier()">Retour à l'accueil</button>\n            </div>\n        </div>\n        `;document.querySelector(".modal").innerHTML=r,this.optionModal()}optionModal(){document.getElementById("myModal").style.display="block"}isValid(e){if("nom"==e.name){let t=document.querySelector(".error_nom");if(""===e.value)return e.className="",this.fields[e.id]=!1,document.getElementById("valid-btn").disabled=!0,t.className="error_nom empty";if(!e.validity.valid)return e.className="",this.fields[e.id]=!1,document.getElementById("valid-btn").disabled=!0,t.className="error_nom badFormatNom";t.className="error_nom"}if("prenom"==e.name){let t=document.querySelector(".error_prenom");if(""===e.value)return e.className="",this.fields[e.id]=!1,document.getElementById("valid-btn").disabled=!0,t.className="error_prenom empty";if(!e.validity.valid)return e.className="",this.fields[e.id]=!1,document.getElementById("valid-btn").disabled=!0,t.className="error_prenom badFormatPrenom";t.className="error_prenom"}if("adresse"==e.name){let t=document.querySelector(".error_adresse");if(""===e.value)return e.className="",this.fields[e.id]=!1,document.getElementById("valid-btn").disabled=!0,t.className="error_adresse empty";if(!e.validity.valid)return e.className="",this.fields[e.id]=!1,document.getElementById("valid-btn").disabled=!0,t.className="error_adresse badFormat";t.className="error_adresse"}if("ville"==e.name){let t=document.querySelector(".error_ville");if(""===e.value)return e.className="",this.fields[e.id]=!1,document.getElementById("valid-btn").disabled=!0,t.className="error_ville empty";if(!e.validity.valid)return e.className="",this.fields[e.id]=!1,document.getElementById("valid-btn").disabled=!0,t.className="error_ville badFormat";t.className="error_ville"}if("email"==e.name){let t=document.querySelector(".error_email");if(""===e.value)return e.className="",this.fields[e.id]=!1,document.getElementById("valid-btn").disabled=!0,t.className="error_email empty";if(!e.validity.valid)return e.className="",this.fields[e.id]=!1,document.getElementById("valid-btn").disabled=!0,t.className="error_email badFormat";t.className="error_email"}e.className="success",this.fields[e.id]=!0;let t=0;const a=Object.values(this.fields).length;for(const e of Object.values(this.fields))e&&t++;t===a&&(document.getElementById("valid-btn").disabled=!1)}}class Produit{constructor(e,t){this.getData(e,t)}async getData(e,t){const a=await orinoco.dataManager.getProduct(t),n=new Article(a);e.innerHTML=`\n        \n          <select name="camera" class="camera" id="camera" onchange="orinoco.pageManager.changePage('produit_' + this.value, 'Oricono - Camera '+this.options[this.selectedIndex].text)">        \n                ${await this.selectCamera(n.name)}\n          </select>\n          ${n.afficheDetails()}\n        `}async selectCamera(e){let t="";const a=await orinoco.dataManager.getAllProducts();for(let n=0,i=a.length;n<i;n++)t+=`<option ${e===a[n].name?"selected":""} value="${a[n]._id}">${a[n].name}</option>`;return t}}class DataManager{products=null;src;constructor(e){this.src=e}async getAllProducts(){const e=await fetch(this.src);return this.products=await e.json(),this.products}async getProduct(e){try{if(null!==this.products)return this.findInProducts(e);const t=await fetch(this.src+"/"+e);return await t.json()}catch(e){console.error(e),alert("nous un souci technique")}}async postPanier(e){try{const t={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)},a=await fetch(this.src+"/order",t);return await a.json()}catch(e){console.error(e),alert("souci technique")}}findInProducts(e){for(let t=0,a=this.products.length;t<a;t++)if(this.products[t]._id===e)return this.products[t];throw"can't find product"}saveCart(e){localStorage.setItem("cart",JSON.stringify(e))}reloadCart(){const e=localStorage.getItem("cart");return null===e?[]:JSON.parse(e)}deletePanier(){localStorage.clear(Cart),orinoco.cart.content=[],orinoco.cart.render(),orinoco.pageManager.changePage("","Orinoco - Vente de caméras en ligne")}}class PageManager{page=null;domTarget=null;constructor(e){this.domTarget=e,this.showPage(window.location.search.slice(1)),window.onpopstate=()=>this.showPage(window.location.search.slice(1))}showPage(e){return document.getElementById("menuCheck").checked="none",""===e?this.page=new Home(this.domTarget):"panier"===e?this.page=new Panier(this.domTarget):"produit"===e.slice(0,7)?this.page=new Produit(this.domTarget,e.slice(8)):void(this.page=new PageError)}changePage(e,t){document.title=t,history.pushState({},t,"?"+e),this.showPage(e)}}const orinoco={dataManager:new DataManager("http://localhost:3000/api/cameras"),components:{}};orinoco.cart=new Cart(document.querySelector(".shopping_cart")),orinoco.pageManager=new PageManager(document.querySelector("main"));